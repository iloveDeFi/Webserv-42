global:
  user: www-data
  worker_processes: auto
  pid: /run/nginx.pid
  include:
    - /etc/nginx/modules-enabled/*.conf

events:
  worker_connections: 768
  # multi_accept: on

http:
  sendfile: on
  tcp_nopush: on
  types_hash_max_size: 2048
  # server_tokens: off
  # server_names_hash_bucket_size: 64
  # server_name_in_redirect: off
  include:
    - /etc/nginx/mime.types
  default_type: application/octet-stream

  ssl_protocols:
    - TLSv1
    - TLSv1.1
    - TLSv1.2
    - TLSv1.3
  ssl_prefer_server_ciphers: on

  access_log: /var/log/nginx/access.log
  error_log: /var/log/nginx/error.log

  gzip: on

  servers:
    - listen: 
        - 80
        - '[::]:80'
      server_name: 
        - example.com
        - www.example.com
      root: /var/www/example.com
      index:
        - index.html
        - index.htm
        - index.nginx-debian.html
      client_max_body_size: 10M
      error_page:
        404: /404.html
        500: /50x.html
        502: /50x.html
        503: /50x.html
        504: /50x.html
      
      locations:
        - path: /
          limit_except:
            methods:
              - GET
              - POST
              - DELETE
            action: deny all
          autoindex: on
          index:
            - index.html
            - index.htm
          try_files:
            - $uri
            - $uri/
            - =404

        - path: /upload
          limit_except:
            methods:
              - POST
            action: deny all
          client_body_temp_path: /var/www/example.com/uploads
          upload_store: /var/www/example.com/uploads
          upload_pass: '@upload_handler'

        - path: '@upload_handler'
          proxy_pass: http://localhost:8000

        - path: ~ \.php$
          fastcgi_pass: unix:/var/run/php/php7.4-fpm.sock
          fastcgi_index: index.php
          include: fastcgi_params
          fastcgi_param:
            SCRIPT_FILENAME: $document_root$fastcgi_script_name

        - path: /old-page
          return: 
            code: 301
            url: /new-page

    - listen: 8080
      server_name: subdomain.example.com
      root: /var/www/subdomain
      index: 
        - index.html
      locations:
        - path: /
          try_files:
            - $uri
            - $uri/
            - =404